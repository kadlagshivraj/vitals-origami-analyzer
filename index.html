<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vitals & Origami Analyzer ‚Äî Kadlag Shivraj</title>
<meta name="description" content="Vitals + Origami studio ‚Äî visual folding steps + tutorial videos. Educational only." />
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --brand:#4f46e5; --muted:#64748b; --ink:#0f172a; --border:#e5e7eb;
    --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--ink)}
  .wrap{max-width:1100px;margin:20px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
  .title{font-weight:800;font-size:20px}
  .actions{display:flex;gap:8px}
  .pill{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:700}
  .brand{background:var(--brand);color:#fff;border-color:var(--brand)}
  .ghost{background:#f8fafc}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:0 6px 18px rgba(15,23,42,.05)}
  h2{margin:0 0 8px}
  label{display:block;font-weight:700;margin-bottom:6px}
  input,select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
  .grid-2{display:grid;grid-template-columns:1fr 420px;gap:12px}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .muted{color:var(--muted);font-size:13px}
  .tag{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:700}
  .score{padding:12px;border-radius:10px;background:#0f172a;color:#fff;font-weight:800}
  .gallery{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
  .tile{border-radius:12px;overflow:hidden;border:1px solid var(--border);cursor:pointer;display:flex;flex-direction:column}
  .thumb{height:100px;display:grid;place-items:center;font-size:44px}
  .tile h4{margin:0;padding:8px 10px;border-top:1px solid var(--border);text-align:center}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:60;padding:12px}
  .modal .box{background:#fff;padding:12px;border-radius:10px;max-width:900px;width:100%;border:1px solid var(--border)}
  .img-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:8px}
  .img-grid img{width:100%;border-radius:8px;border:1px solid var(--border)}
  .list{padding-left:18px}
  footer{margin:18px 0;color:var(--muted);font-size:13px}
  @media (max-width:1000px){ .grid-2{grid-template-columns:1fr} .gallery{grid-template-columns:repeat(2,1fr)} .img-grid{grid-template-columns:repeat(2,1fr)} }
  /* small helper for links inside modal */
  .link-btn{display:inline-block;padding:8px 10px;border-radius:8px;background:#f8fafc;border:1px solid var(--border);text-decoration:none;color:var(--ink);font-weight:700;margin-right:8px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Vitals & Origami Analyzer ‚Äî <span style="color:var(--brand)">Kadlag Shivraj</span></div>
      <div class="actions">
        <button id="demo" class="pill" type="button">Demo</button>
        <button id="reset" class="pill ghost" type="button">Reset</button>
        <button id="printBtn" class="pill brand" type="button">Print / PDF</button>
      </div>
    </header>

    <!-- Origami gallery first -->
    <section class="card" id="galleryCard">
      <h2 style="display:flex;align-items:center;gap:8px">Origami Gallery <span class="muted" style="font-weight:600;font-size:13px">‚Äî tap a model to learn (images + video)</span></h2>
      <div class="gallery" style="margin-top:12px">
        <div class="tile" data-model="boat"><div class="thumb" style="background:#e0f2fe">üö§</div><h4>Boat</h4></div>
        <div class="tile" data-model="airplane"><div class="thumb" style="background:#ecfeff">‚úàÔ∏è</div><h4>Airplane</h4></div>
        <div class="tile" data-model="crane"><div class="thumb" style="background:#fef3c7">üïäÔ∏è</div><h4>Crane</h4></div>
        <div class="tile" data-model="flower"><div class="thumb" style="background:#fee2e2">üå∏</div><h4>Flower</h4></div>
        <div class="tile" data-model="frog"><div class="thumb" style="background:#dcfce7">üê∏</div><h4>Frog</h4></div>
      </div>
    </section>

    <!-- Survey + Inputs -->
    <div class="grid-2">
      <section class="card" id="surveyCard">
        <h2>Focus & Memory Survey (short)</h2>
        <p class="muted">Survey is central ‚Äî submit this, then press "Include survey in analysis".</p>

        <label>How many minutes did you fold today?</label>
        <input id="q_minutes" type="number" min="0" placeholder="e.g., 8" />

        <div style="margin-top:10px">
          <label>Could you concentrate well?</label>
          <select id="q_concentrate"><option value=""></option><option>Yes</option><option>Maybe</option><option>No</option></select>
        </div>
        <div style="margin-top:10px">
          <label>Did you feel patient during folding?</label>
          <select id="q_patience"><option value=""></option><option>Yes</option><option>Maybe</option><option>No</option></select>
        </div>
        <div style="margin-top:10px">
          <label>Can you remember how to make a butterfly?</label>
          <select id="q_butterfly"><option value=""></option><option>Yes</option><option>Maybe</option><option>No</option></select>
        </div>
        <div style="margin-top:10px">
          <label>Did you feel calmer after folding?</label>
          <select id="q_calm"><option value=""></option><option>Yes</option><option>Maybe</option><option>No</option></select>
        </div>
        <div style="margin-top:10px">
          <label>Could you ignore distractions?</label>
          <select id="q_ignore"><option value=""></option><option>Yes</option><option>Maybe</option><option>No</option></select>
        </div>
        <div style="margin-top:10px">
          <label>Will you practice again tomorrow?</label>
          <select id="q_tomorrow"><option value=""></option><option>Yes</option><option>Maybe</option><option>No</option></select>
        </div>

        <div style="margin-top:12px" class="actions">
          <button id="surveyAnalyze" class="pill brand" type="button">Include survey in analysis</button>
          <button id="surveySave" class="pill" type="button">Save survey</button>
          <button id="surveyLoad" class="pill ghost" type="button">Load last</button>
        </div>
      </section>

      <section class="card" id="measureCard">
        <h2>Enter Measurements</h2>
        <p class="muted">If you prefer, fill vitals. Survey & origami are the priority.</p>

        <div class="grid-3" style="margin-top:8px">
          <div><label>Heart rate (BPM)</label><input id="bpm" type="number" placeholder="72" /><div id="bpmTag" class="tag" style="margin-top:8px">‚Äî</div></div>
          <div><label>Breaths/min (BRPM)</label><input id="brpm" type="number" placeholder="14" /><div id="brpmTag" class="tag" style="margin-top:8px">‚Äî</div></div>
          <div><label>Steps/min (SPM)</label><input id="spm" type="number" placeholder="110" /><div id="spmTag" class="tag" style="margin-top:8px">‚Äî</div></div>
        </div>

        <div class="grid-3" style="margin-top:12px">
          <div><label>Systolic BP</label><input id="sys" type="number" placeholder="120" /><div id="sysTag" class="tag" style="margin-top:8px">‚Äî</div></div>
          <div><label>Diastolic BP</label><input id="dia" type="number" placeholder="80" /><div id="diaTag" class="tag" style="margin-top:8px">‚Äî</div></div>
          <div><label>SpO‚ÇÇ (%)</label><input id="spo2" type="number" placeholder="98" /><div id="spo2Tag" class="tag" style="margin-top:8px">‚Äî</div></div>
        </div>

        <div style="margin-top:12px" class="card">
          <h3>Origami practice & notes</h3>
          <div style="margin-top:8px">
            <label>Origami practiced today?</label>
            <select id="origami"><option value=""></option><option value="yes">Yes</option><option value="no">No</option></select>
          </div>
          <div style="margin-top:8px"><label>Notes</label><textarea id="notes" rows="3" placeholder="sleep, meds, folding details..."></textarea></div>

          <div style="margin-top:12px" class="actions">
            <button id="analyze" class="pill brand" type="button">Analyze</button>
            <button id="save" class="pill" type="button">Save session</button>
            <button id="export" class="pill" type="button">Export CSV</button>
            <button id="load" class="pill ghost" type="button">Load last</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <div id="scoreBox" class="score">Survey first ‚Äî then Analyze</div>
          <div id="findings" style="margin-top:10px"></div>
        </div>
      </section>
    </div>

    <section class="card">
      <h2>Origami Studio</h2>
      <div style="display:flex;gap:12px;align-items:flex-start;margin-top:8px;flex-wrap:wrap">
        <div style="flex:1;min-width:240px" class="card">
          <h3>Box Breathing (4-4-4-4)</h3>
          <div style="display:flex;gap:8px;align-items:center;margin:8px 0">
            <button id="breathStart" class="pill brand" type="button">Start</button>
            <button id="breathStop" class="pill" type="button">Stop</button>
            <span id="breathPhase" class="muted">Ready</span>
          </div>
          <div style="height:120px;border:1px dashed var(--border);border-radius:8px;display:grid;place-items:center">
            <div id="ball" style="width:56px;height:56px;border-radius:50%;background:var(--brand)"></div>
          </div>
          <p class="muted" style="margin-top:8px">Use 1‚Äì3 minutes before a session to steady breathing and focus.</p>
        </div>

        <div style="flex:1;min-width:240px" class="card">
          <h3>Folding Metronome</h3>
          <label>Folds per minute</label>
          <input id="foldFPM" type="range" min="6" max="18" value="10" />
          <div style="margin-top:8px">Tempo: <span id="foldFPMVal">10</span> fpm</div>
          <div style="margin-top:8px" class="actions"><button id="metroStart" class="pill brand" type="button">Start</button><button id="metroStop" class="pill" type="button">Stop</button></div>
          <p class="muted" style="margin-top:8px">Use steady tempo for repetitive folds (calm rhythm).</p>
        </div>
      </div>
    </section>

    <footer class="muted">¬© <span id="yr"></span> ‚Ä¢ Built by Kadlag Shivraj ‚Ä¢ Educational only</footer>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 id="mTitle" style="margin:0"></h3>
        <button id="mClose" class="pill" type="button">Close</button>
      </div>
      <div id="mImgs" class="img-grid" aria-hidden="false"></div>
      <ol id="mSteps" class="list"></ol>
      <div id="mVideo" style="margin-top:10px"></div>
      <div style="margin-top:8px">
        <a id="mLink" class="link-btn" href="#" target="_blank" rel="noopener">Open source page</a>
      </div>
    </div>
  </div>

<script>
/* Helper */
const $ = id => document.getElementById(id);
function bind(id, evt, fn){ const el=$(id); if(el) el.addEventListener(evt, fn); }
function setTag(id, text, tone){ const el=$(id); if(!el) return; el.textContent = text||'‚Äî'; el.className = 'tag' + (tone?(' '+tone):''); }

/* Resources: thumbnails, video IDs, step pages */
const MODEL_RESOURCES = {
  boat: {
    title: 'Paper Boat',
    thumbs: ['https://img.youtube.com/vi/vNba3jbBSOw/hqdefault.jpg','https://img.youtube.com/vi/b3QZpBL8-Tg/hqdefault.jpg'],
    steps_page: 'https://origami.me/boat/',
    videoId: 'vNba3jbBSOw'
  },
  airplane: {
    title: 'Paper Airplane (Dart)',
    thumbs: ['https://img.youtube.com/vi/gZQI1Z_viNg/hqdefault.jpg','https://img.youtube.com/vi/dCrxMJcVuyw/hqdefault.jpg'],
    steps_page: 'https://origami.me/easy-origami/',
    videoId: 'gZQI1Z_viNg'
  },
  crane: {
    title: 'Traditional Crane',
    thumbs: ['https://img.youtube.com/vi/NXs0ckqVYwg/hqdefault.jpg'],
    steps_page: 'https://www.origamiway.com/origami-crane/',
    videoId: 'NXs0ckqVYwg'
  },
  flower: {
    title: 'Simple Tulip',
    thumbs: ['https://img.youtube.com/vi/na4XF5zVn6w/hqdefault.jpg'],
    steps_page: 'https://www.instructables.com/Origami-Tulips/',
    videoId: 'na4XF5zVn6w'
  },
  frog: {
    title: 'Jumping Frog',
    thumbs: ['https://img.youtube.com/vi/UY6xg6Y1a2g/hqdefault.jpg'], // fallback YouTube frog tutorial id used
    steps_page: 'https://origami.me/jumping-frog/',
    videoId: 'UY6xg6Y1a2g'
  }
};

/* Interpret vitals (defensive) */
function interpret(){
  const get = id => { const e=$(id); return e? +e.value : NaN; };
  const v = { bpm:get('bpm'), brpm:get('brpm'), spm:get('spm'), sys:get('sys'), dia:get('dia'), spo2:get('spo2'), anx: ($( 'anx')? +$('anx').value : 0) };
  if(!isNaN(v.bpm)){ let tone='ok',txt='Normal'; if(v.bpm<50){tone='warn';txt='Low'} if(v.bpm<40){tone='bad';txt='Bradycardia'} if(v.bpm>90){tone='warn';txt='High'} if(v.bpm>100){tone='bad';txt='Tachycardia'} setTag('bpmTag',txt,tone);} else setTag('bpmTag','‚Äî');
  if(!isNaN(v.brpm)){ let tone='ok',txt='Normal'; if(v.brpm<10){tone='warn';txt='Low'} if(v.brpm<8){tone='bad';txt='Very low'} if(v.brpm>20){tone='warn';txt='High'} if(v.brpm>24){tone='bad';txt='Very high'} setTag('brpmTag',txt,tone);} else setTag('brpmTag','‚Äî');
  if(!isNaN(v.spm)){ let tone='ok',txt='Moderate walk'; if(v.spm<60){tone='warn';txt='Very easy'} if(v.spm>=90&&v.spm<120){tone='ok';txt='Brisk'} if(v.spm>=140){tone='warn';txt='Near jog'} setTag('spmTag',txt,tone);} else setTag('spmTag','‚Äî');
  function bpCat(s,d){ if(s>=180||d>=120) return ['Hypertensive crisis','bad']; if(s>=140||d>=90) return ['Hypertension (Stage 2)','bad']; if((s>=130&&s<=139)||(d>=80&&d<=89)) return ['Hypertension (Stage 1)','warn']; if(s>=120&&s<=129&&d<80) return ['Elevated','warn']; if(s<120&&d<80) return ['Normal','ok']; return ['‚Äî','']; }
  if(!isNaN(v.sys) && !isNaN(v.dia)){ const [txt,t]=bpCat(v.sys,v.dia); setTag('sysTag',txt,t); setTag('diaTag',txt,t);} else { setTag('sysTag','‚Äî'); setTag('diaTag','‚Äî'); }
  if(!isNaN(v.spo2)){ let tone='ok',txt='Normal'; if(v.spo2<95){tone='warn';txt='Below normal'} if(v.spo2<92){tone='bad';txt='Low'} setTag('spo2Tag',txt,tone);} else setTag('spo2Tag','‚Äî');
  let at='ok',ax='Low'; if(v.anx>=4 && v.anx<=6){ at='warn'; ax='Moderate'; } if(v.anx>=7){ at='bad'; ax='High'; } setTag('anxTag',ax,at);
  return v;
}

/* Survey scoring */
function scoreSurveyObj(){
  const map = { 'Yes':2, 'Maybe':1, 'No':0, '':0 };
  const minutes = parseInt(($('q_minutes')?$('q_minutes').value:'0')||'0',10) || 0;
  const keys = ['q_concentrate','q_patience','q_butterfly','q_calm','q_ignore','q_tomorrow'];
  const answers = {};
  let s = 0;
  for(const k of keys){ const v = ($(k)?$(k).value:''); answers[k]=v; s += (map[v]||0); }
  const boost = (minutes >= 10 ? 2 : (minutes >= 5 ? 1 : 0));
  const total = s + boost; // out of max 14
  const tag = total >= 10 ? 'Great focus & recall' : total >= 6 ? 'Mixed ‚Äî keep practicing' : 'Low today ‚Äî try short sessions';
  return { score: total, minutes, tag, answers };
}

/* Analysis (merge survey if available) */
function analyze(showAlert=false){
  const v = interpret();
  let score = 100;
  if(!isNaN(v.bpm)){ if(v.bpm<50) score-=5; if(v.bpm<40) score-=10; if(v.bpm>90) score-=5; if(v.bpm>100) score-=10; }
  if(!isNaN(v.brpm)){ if(v.brpm<10||v.brpm>20) score-=8; if(v.brpm<8||v.brpm>24) score-=6; }
  if(!isNaN(v.spm)){ if(v.spm<60) score-=3; if(v.spm>=140) score-=3; }
  if(!isNaN(v.sys) && !isNaN(v.dia)){ if(v.sys>=180||v.dia>=120) score-=25; else if(v.sys>=140||v.dia>=90) score-=15; else if((v.sys>=130&&v.sys<=139)||(v.dia>=80&&v.dia<=89)) score-=8; else if(v.sys>=120&&v.sys<=129&&v.dia<80) score-=3; }
  if(!isNaN(v.spo2)){ if(v.spo2<95) score-=6; if(v.spo2<92) score-=8; }
  if(!isNaN(v.anx)){ if(v.anx>=4) score-=5; if(v.anx>=7) score-=6; }
  score = Math.max(0, Math.min(100, Math.round(score)));

  const lastSurvey = JSON.parse(localStorage.getItem('vitals_survey') || 'null');
  let surveySummary = '';
  if(lastSurvey && lastSurvey.score !== undefined){
    surveySummary = `<div style="margin-top:8px;padding:10px;border-radius:8px;background:#fbfbff;border:1px solid #e6e6ff">Survey score: <strong>${lastSurvey.score}/14</strong> ‚Äî ${lastSurvey.tag}. Minutes folded: ${lastSurvey.minutes}.</div>`;
    if(lastSurvey.score >= 10){ surveySummary += `<div style="margin-top:6px;color:var(--ok)">Nice focus ‚Äî origami practice is helping.</div>`; }
    else if(lastSurvey.score >= 6){ surveySummary += `<div style="margin-top:6px;color:var(--warn)">Mixed results ‚Äî try shorter sessions or metronome pace.</div>`; }
    else { surveySummary += `<div style="margin-top:6px;color:var(--bad)">Low focus today ‚Äî try 2‚Äì5 minutes of box breathing then a very simple fold.</div>`; }
  }

  const orig = $('origami') ? $('origami').value : '';
  const origText = orig === 'yes' ? 'ü¶¢ Origami today: Positive ‚Äî steady folding aids focus.' : orig === 'no' ? 'ü¶¢ Origami: Try 5‚Äì10 min for grounding.' : '';

  const parts = [];
  parts.push(`‚Ä¢ Heart rate: ${isNaN(v.bpm)?'‚Äî':v.bpm+' BPM'} (${$('bpmTag')?$('bpmTag').textContent:'‚Äî'}).`);
  parts.push(`‚Ä¢ Breathing: ${isNaN(v.brpm)?'‚Äî':v.brpm+'/min'} (${$('brpmTag')?$('brpmTag').textContent:'‚Äî'}).`);
  parts.push(`‚Ä¢ Steps cadence: ${isNaN(v.spm)?'‚Äî':v.spm+' SPM'} (${$('spmTag')?$('spmTag').textContent:'‚Äî'}).`);
  if(!isNaN(v.sys) && !isNaN(v.dia)) parts.push(`‚Ä¢ BP: ${v.sys}/${v.dia} mmHg (${$('sysTag')?$('sysTag').textContent:'‚Äî'}).`);
  if(!isNaN(v.spo2)) parts.push(`‚Ä¢ SpO‚ÇÇ: ${v.spo2}%.`);
  parts.push(`‚Ä¢ Anxiety (self-rated): ${isNaN(v.anx)?'‚Äî':v.anx+'/10'} (${$('anxTag')?$('anxTag').textContent:'‚Äî'}).`);
  if(origText) parts.push(origText);
  const notes = $('notes') ? $('notes').value.trim() : '';
  if(notes) parts.push('üóíÔ∏è '+notes);

  $('scoreBox').textContent = `Wellness score: ${score}/100`;
  $('findings').innerHTML = '<div style="margin-top:8px">' + parts.join('<br>') + '</div>' + surveySummary;
  if(showAlert) alert('Analysis complete.');
}

/* Survey handlers */
bind('surveyAnalyze','click', ()=> {
  const obj = scoreSurveyObj();
  localStorage.setItem('vitals_survey', JSON.stringify(obj));
  analyze(true);
});
bind('surveySave','click', ()=> { const obj = scoreSurveyObj(); localStorage.setItem('vitals_survey', JSON.stringify(obj)); alert('Survey saved locally.'); });
bind('surveyLoad','click', ()=> {
  const raw = localStorage.getItem('vitals_survey'); if(!raw) return alert('No saved survey.');
  const p = JSON.parse(raw);
  ['q_minutes','q_concentrate','q_patience','q_butterfly','q_calm','q_ignore','q_tomorrow'].forEach(k=>{ if($(k) && p.answers && p.answers[k]!==undefined) $(k).value = p.answers[k]; });
  if($('q_minutes')) $('q_minutes').value = p.minutes || 0;
  alert('Loaded last survey. Click "Include survey in analysis" to merge.');
});

/* Basic session handlers */
bind('analyze','click', ()=> analyze(true));
bind('demo','click', ()=> {
  if($('bpm')) $('bpm').value=76; if($('brpm')) $('brpm').value=14; if($('spm')) $('spm').value=112;
  if($('sys')) $('sys').value=124; if($('dia')) $('dia').value=82; if($('spo2')) $('spo2').value=97;
  if($('origami')) $('origami').value='yes'; interpret(); alert('Demo values filled. Click Analyze to compute.');
});
bind('reset','click', ()=> {
  document.querySelectorAll('input,textarea,select').forEach(e=>{ if(e.type==='range') e.value = e.defaultValue || 0; else e.value=''; });
  if($('anx')) $('anx').value = 3; if($('foldFPM')) $('foldFPM').value = 10;
  interpret(); $('scoreBox').textContent='Survey first ‚Äî then Analyze'; $('findings').innerHTML=''; localStorage.removeItem('vitals_last');
});
bind('save','click', ()=> {
  const payload = { ts:new Date().toISOString(), bpm:$('bpm')?$('bpm').value:'', brpm:$('brpm')?$('brpm').value:'', spm:$('spm')?$('spm').value:'', sys:$('sys')?$('sys').value:'', dia:$('dia')?$('dia').value:'', spo2:$('spo2')?$('spo2').value:'', origami:$('origami')?$('origami').value:'', notes:$('notes')?$('notes').value:'' };
  localStorage.setItem('vitals_last', JSON.stringify(payload));
  const log = JSON.parse(localStorage.getItem('vitals_log') || '[]'); log.push(payload); localStorage.setItem('vitals_log', JSON.stringify(log)); alert('Session saved locally.');
});
bind('load','click', ()=> {
  const raw = localStorage.getItem('vitals_last'); if(!raw) return alert('No saved session');
  const p = JSON.parse(raw); ['bpm','brpm','spm','sys','dia','spo2','anx','notes','origami'].forEach(k=>{ if($(k) && p[k]!==undefined) $(k).value = p[k]; });
  interpret(); alert('Loaded last session.');
});
bind('export','click', ()=> {
  const log = JSON.parse(localStorage.getItem('vitals_log') || '[]'); if(!log.length) return alert('No saved sessions');
  const header = Object.keys(log[0]);
  const csv = [header.join(','), ...log.map(r => header.map(h => `"${String(r[h]||'').replace(/"/g,'""')}"`).join(','))].join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const a=document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='vitals-origami-log.csv'; a.click(); URL.revokeObjectURL(a.href);
});

/* Breathing */
let breathTimer = null;
bind('breathStart','click', ()=> { clearInterval(breathTimer); let t=0; $('breathPhase').textContent='Inhale'; $('ball').style.transform='scale(0.8)'; breathTimer=setInterval(()=>{ t=(t+1)%16; const phase=Math.floor(t/4); const map=['Inhale','Hold','Exhale','Hold']; $('breathPhase').textContent = map[phase]; const sz=[0.8,1.0,0.8,0.7][phase]; $('ball').style.transform = `scale(${sz})`; },1000); });
bind('breathStop','click', ()=> { clearInterval(breathTimer); $('breathPhase').textContent='Ready'; $('ball').style.transform='scale(1)'; });

/* Metronome */
let audioCtx=null, metroInt=null;
bind('metroStart','click', ()=> {
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  clearInterval(metroInt);
  const bpm = parseInt($('foldFPM')?$('foldFPM').value:10,10) || 10;
  metroInt = setInterval(()=>{ const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.001; o.connect(g); g.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.001); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.12); o.stop(audioCtx.currentTime+0.13); }, 60000/bpm);
});
bind('metroStop','click', ()=> clearInterval(metroInt));
bind('foldFPM','input', ()=> { if($('foldFPMVal')) $('foldFPMVal').textContent = $('foldFPM')?$('foldFPM').value:10; });

/* Gallery modal opening: builds thumbnails, fills steps and embeds YouTube (if present) */
function openModel(key){
  const res = MODEL_RESOURCES[key];
  if(!res) return;
  $('mTitle').textContent = res.title || key;
  $('mSteps').innerHTML = ''; $('mImgs').innerHTML = ''; $('mVideo').innerHTML = ''; $('mLink').href = res.steps_page || '#';
  // thumbnails: clickable to open full size in new tab
  (res.thumbs || []).forEach(src => {
    const img = document.createElement('img'); img.src = src; img.alt = res.title; img.loading='lazy';
    img.style.cursor = 'pointer';
    img.addEventListener('click', ()=> window.open(src, '_blank'));
    $('mImgs').appendChild(img);
  });
  // steps (if resource page exists, we provide steps from our small internal list or link)
  const modelSteps = (function(){
    if(key === 'boat') return ['Fold A4 in half (short edges together).','Fold top corners down to meet center (hat).','Fold bottom flap up; flip and fold other flap up.','Open hat into diamond; flatten.','Fold bottom point up to top point; repeat.','Open to form boat.'];
    if(key === 'airplane') return ['Fold A4 lengthwise (crease) and unfold.','Bring top corners to center crease.','Fold top edges to center again.','Fold plane in half and fold wings down.','Adjust wings & fling gently.'];
    if(key === 'crane') return ['Start square: fold diagonals and halves; collapse into square base.','Fold kite edges to center; squash to long diamond.','Reverse-fold legs and head; pull wings out.'];
    if(key === 'flower') return ['Square to triangle.','Bring corners up to top (diamond).','Tuck sides to round petals.','Fold bottom tip up and add stem.'];
    if(key === 'frog') return ['Start 3:2 rectangle.','Make waterbomb base.','Fold bottom up to form legs.','Create spring fold; press and release to jump.'];
    return [];
  })();
  $('mSteps').innerHTML = modelSteps.map(s => `<li>${s}</li>`).join('');
  // video embed fallback
  if(res.videoId){
    const iframe = document.createElement('iframe');
    iframe.width = '100%';
    iframe.height = '360';
    iframe.src = `https://www.youtube.com/embed/${res.videoId}?rel=0`;
    iframe.title = `${res.title} tutorial`;
    iframe.frameBorder = '0';
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen = true;
    $('mVideo').appendChild(iframe);
  } else {
    // if no video id, show link to steps page
    $('mVideo').innerHTML = `<div class="muted">No video available. Open the source page below for step photos.</div>`;
  }
  document.getElementById('modal').style.display = 'flex';
}
document.querySelectorAll('.tile').forEach(t => t.addEventListener('click', ()=> openModel(t.dataset.model)));
bind('mClose','click', ()=> document.getElementById('modal').style.display='none');
document.getElementById('modal').addEventListener('click', e => { if(e.target.id==='modal') e.currentTarget.style.display='none'; });

/* init */
$('yr').textContent = new Date().getFullYear();
interpret();

/* minor error banner in case an exception happens (will show on page). */
window.addEventListener('error', function(evt){
  try{
    const d = document.createElement('div');
    d.style.position='fixed'; d.style.bottom='12px'; d.style.left='12px'; d.style.background='#fee2e2';
    d.style.color='#7f1d1d'; d.style.padding='8px 10px'; d.style.border='1px solid #fecaca'; d.style.borderRadius='8px'; d.style.zIndex=9999; d.style.fontSize='12px';
    d.textContent = 'Script error: ' + (evt && evt.message ? evt.message : 'unknown');
    document.body.appendChild(d);
  }catch(e){}
});
</script>
</body>
</html>







