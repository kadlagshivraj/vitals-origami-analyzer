<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vitals & Anxiety Analyzer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Offline, single‚Äëfile analyzer for BPM, breaths/min, steps/min, BP, SpO‚ÇÇ, and self‚Äërated anxiety with printable report. Not medical advice." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --muted:#64748b; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .card { @apply bg-white rounded-2xl shadow-lg p-5 md:p-7; }
    .pill { @apply inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold; }
    .metric { @apply grid grid-cols-1 md:grid-cols-3 gap-3 items-center; }
    @media print{ .noprint{ display:none!important } body { background:#fff } .card { box-shadow:none } }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="noprint sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class=\"flex items-center gap-3\">
        <h1 class=\"text-xl md:text-2xl font-extrabold tracking-tight\">Vitals & Origami Analyzer</h1>
        <span class=\"hidden md:inline pill bg-slate-100 text-slate-700\">by Kadlag Shivraj</span>
      </div>
      <div class=\"flex gap-2\">
        <button id=\"btnDark\" class=\"pill bg-slate-200\">Dark</button>
        <button id=\"btnDemo\" class=\"pill bg-slate-900 text-white\">Demo data</button>
        <button id=\"btnReset\" class=\"pill bg-slate-200\">Reset</button>
        <button id=\"btnExport\" class=\"pill bg-emerald-600 text-white\">Export CSV</button>
        <button id=\"btnPrint\" class=\"pill bg-indigo-600 text-white\">Print / PDF</button>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4 md:p-6 space-y-6">
    <section class="card">
      <h2 class="text-lg md:text-xl font-bold mb-1">Enter Measurements</h2>
      <p class="text-sm text-slate-600 mb-5">These checks are recreational and educational. Results are approximations only and <strong>not medical advice</strong>.</p>

      <div class="grid md:grid-cols-2 gap-5">
        <!-- Left column inputs -->
        <div class="space-y-4">
          <div class="metric">
            <label class="font-semibold">Heart rate (BPM)</label>
            <input id="bpm" type="number" min="20" max="240" placeholder="e.g., 72" class="w-full rounded-xl border-slate-300"/>
            <div id="bpmTag" class="pill bg-slate-100 text-slate-700 justify-self-start md:justify-self-end">‚Äî</div>
          </div>
          <div class="metric">
            <label class="font-semibold">Breaths per min (BRPM)</label>
            <input id="brpm" type="number" min="4" max="60" placeholder="e.g., 14" class="w-full rounded-xl border-slate-300"/>
            <div id="brpmTag" class="pill bg-slate-100 text-slate-700 justify-self-start md:justify-self-end">‚Äî</div>
          </div>
          <div class="metric">
            <label class="font-semibold">Steps per min (SPM / cadence)</label>
            <input id="spm" type="number" min="0" max="250" placeholder="e.g., 110" class="w-full rounded-xl border-slate-300"/>
            <div id="spmTag" class="pill bg-slate-100 text-slate-700 justify-self-start md:justify-self-end">‚Äî</div>
          </div>
        </div>

        <!-- Right column inputs -->
        <div class="space-y-4">
          <div class="metric">
            <label class="font-semibold">Systolic BP (mmHg)</label>
            <input id="sys" type="number" min="70" max="260" placeholder="e.g., 118" class="w-full rounded-xl border-slate-300"/>
            <div id="sysTag" class="pill bg-slate-100 text-slate-700 justify-self-start md:justify-self-end">‚Äî</div>
          </div>
          <div class="metric">
            <label class="font-semibold">Diastolic BP (mmHg)</label>
            <input id="dia" type="number" min="40" max="180" placeholder="e.g., 76" class="w-full rounded-xl border-slate-300"/>
            <div id="diaTag" class="pill bg-slate-100 text-slate-700 justify-self-start md:justify-self-end">‚Äî</div>
          </div>
          <div class="metric">
            <label class="font-semibold">SpO‚ÇÇ (%)</label>
            <input id="spo2" type="number" min="50" max="100" placeholder="e.g., 98" class="w-full rounded-xl border-slate-300"/>
            <div id="spo2Tag" class="pill bg-slate-100 text-slate-700 justify-self-start md:justify-self-end">‚Äî</div>
          </div>
        </div>
      </div>

      <div class="mt-6 grid md:grid-cols-3 gap-4">
        <div class="card">
          <h3 class="font-semibold">Self‚Äërated anxiety (0‚Äì10)</h3>
          <input id="anx" type="range" min="0" max="10" step="1" value="3" class="w-full"/>
          <div class="flex items-center justify-between text-sm mt-1">
            <span id="anxValue" class="font-bold">3</span>
            <span id="anxTag" class="pill bg-slate-100">‚Äî</span>
          </div>
        </div>
        <div class="card">
          <h3 class="font-semibold">Resting / Active</h3>
          <div class="flex gap-3 mt-2">
            <label class="inline-flex items-center gap-2"><input type="radio" name="ctx" value="rest" checked> Resting</label>
            <label class="inline-flex items-center gap-2"><input type="radio" name="ctx" value="active"> Active</label>
          </div>
          <p class="text-xs text-slate-500 mt-2">This adjusts thresholds for BPM & SPM interpretation.</p>
        </div>
        <div class="card">
          <h3 class="font-semibold">Notes</h3>
          <textarea id="notes" rows="3" placeholder="How you feel, meds, sleep, origami practice notes, etc." class="w-full rounded-xl border-slate-300"></textarea><div class="mt-3"><label class="text-sm font-semibold">Origami practice:</label><select id="origami" class="w-full rounded-xl border-slate-300 mt-1"><option value="">Select</option><option value="yes">Yes, practiced today</option><option value="no">No</option></select></div>
        </div>
      </div>

      <div class="mt-6 flex flex-wrap gap-3">
        <button id="btnAnalyze" class="pill bg-indigo-600 text-white">Analyze</button>
        <button id="btnSave" class="pill bg-emerald-600 text-white">Save session</button>
        <button id="btnLoad" class="pill bg-slate-200">Load last</button>
      </div>
    </section>

    <section id="results" class="card hidden">
      <h2 class="text-lg md:text-xl font-bold mb-3">Results</h2>
      <div id="scoreWrap" class="mb-4"></div>
      <div id="findings" class="space-y-2"></div>

      <div class="mt-6 border-t pt-4 text-sm text-slate-600">
        <p class="mb-2"><strong>Practice more:</strong> Gentle breathing drills (inhale 4s, exhale 6s √ó 10), light walking aiming for a steady cadence, and 5‚Äì10 minutes of simple <em>origami</em> folding for focus and hand‚Äëeye coordination.</p>
        <p class="mb-2"><strong>Educational note:</strong> This tool is based on general physiology references and recreational math‚Äëstyle scoring. Values can be affected by meds, illness, or device error. It is <strong>not a diagnosis</strong>. If you have symptoms or abnormal readings, <strong>consult a qualified doctor</strong>.</p>
      </div>
    </section>

    <section class=\"card\">
      <h2 class=\"text-lg md:text-xl font-bold mb-3\">Origami Studio</h2>
      <div class=\"grid md:grid-cols-3 gap-4\">
        <div class=\"rounded-2xl p-5 bg-white border border-slate-200\">
          <h3 class=\"font-semibold\">Box Breathing (4-4-4-4)</h3>
          <div class=\"mt-2 flex items-center gap-3\">
            <button id=\"breathStart\" class=\"pill bg-slate-900 text-white\">Start</button>
            <button id=\"breathStop\" class=\"pill bg-slate-200\">Stop</button>
            <span id=\"breathPhase\" class=\"text-sm text-slate-600\">Ready</span>
          </div>
          <div class=\"mt-3 w-full h-28 bg-slate-100 rounded-xl overflow-hidden relative\">
            <div id=\"breathBall\" class=\"absolute left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-indigo-500\"></div>
          </div>
          <p class=\"text-xs text-slate-500 mt-2\">Follow the ball: inhale ‚Üí hold ‚Üí exhale ‚Üí hold. 1‚Äì3 minutes before measurement.</p>
        </div>
        <div class=\"rounded-2xl p-5 bg-white border border-slate-200\">
          <h3 class=\"font-semibold\">Folding Metronome</h3>
          <label class=\"text-sm\">Folds per minute</label>
          <input id=\"foldFPM\" type=\"range\" min=\"6\" max=\"18\" value=\"10\" class=\"w-full\"/>
          <div class=\"text-sm mt-1\"><span id=\"foldFPMVal\">10</span> fpm</div>
          <div class=\"mt-2 flex gap-3\">
            <button id=\"metroStart\" class=\"pill bg-slate-900 text-white\">Start</button>
            <button id=\"metroStop\" class=\"pill bg-slate-200\">Stop</button>
          </div>
          <p class=\"text-xs text-slate-500 mt-2\">Use as gentle pace while folding (valley ‚Üí mountain ‚Üí turn).</p>
        </div>
        <div class=\"rounded-2xl p-5 bg-white border border-slate-200\">
          <h3 class=\"font-semibold\">Quick Origami: Simple Cup</h3>
          <ol class=\"list-decimal list-inside text-sm space-y-1\">
            <li>Start with a square paper (colored side up).</li>
            <li>Fold in half diagonally to make a triangle.</li>
            <li>Bring right corner to the left edge (about 1/3 across).</li>
            <li>Fold left corner to the right edge symmetrically.</li>
            <li>Fold front top flap down; flip and fold back flap down.</li>
          </ol>
          <p class=\"text-xs text-slate-500 mt-2\">Sip water only briefly ‚Äî it‚Äôs paper! Focus on clean creases & steady breathing.</p>
        </div>
      </div>
   </section>

    <section class=\"card\">
      <h2 class=\"text-lg md:text-xl font-bold mb-2\">Origami Gallery</h2>
      <p class=\"text-sm text-slate-600 mb-3\">Tap a model to see quick, printable folding steps.</p>
      <div class=\"grid sm:grid-cols-2 md:grid-cols-5 gap-4\">
        <button class=\"group\" data-model=\"boat\">
          <img alt=\"Paper boat\" class=\"w-full aspect-square rounded-2xl shadow group-hover:scale-[1.02] transition\" src=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='200' height='200' rx='24' fill='%23e0f2fe'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='72'>üö§</text><text x='50%' y='88%' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='%2303345d'>Boat</text></svg>\"/>
        </button>
        <button class=\"group\" data-model=\"airplane\">
          <img alt=\"Paper airplane\" class=\"w-full aspect-square rounded-2xl shadow group-hover:scale-[1.02] transition\" src=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='200' height='200' rx='24' fill='%23ecfeff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='72'>‚úàÔ∏è</text><text x='50%' y='88%' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='%2303345d'>Airplane</text></svg>\"/>
        </button>
        <button class=\"group\" data-model=\"crane\">
          <img alt=\"Paper crane\" class=\"w-full aspect-square rounded-2xl shadow group-hover:scale-[1.02] transition\" src=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='200' height='200' rx='24' fill='%23fef3c7'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='72'>üïäÔ∏è</text><text x='50%' y='88%' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='%236b4000'>Crane</text></svg>\"/>
        </button>
        <button class=\"group\" data-model=\"flower\">
          <img alt=\"Paper flower\" class=\"w-full aspect-square rounded-2xl shadow group-hover:scale-[1.02] transition\" src=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='200' height='200' rx='24' fill='%23fee2e2'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='72'>üå∏</text><text x='50%' y='88%' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='%23711313'>Flower</text></svg>\"/>
        </button>
        <button class=\"group\" data-model=\"frog\">
          <img alt=\"Paper frog\" class=\"w-full aspect-square rounded-2xl shadow group-hover:scale-[1.02] transition\" src=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='200' height='200' rx='24' fill='%23dcfce7'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='72'>üê∏</text><text x='50%' y='88%' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='%230a3a1b'>Frog</text></svg>\"/>
        </button>
      </div>
    </section>

    <!-- Modal for model steps -->
    <div id=\"modelModal\" class=\"fixed inset-0 hidden items-center justify-center bg-black/50 p-4 z-40\">
      <div class=\"bg-white rounded-2xl shadow-xl max-w-xl w-full p-5 relative\">
        <button id=\"modalClose\" class=\"pill bg-slate-200 absolute top-3 right-3\">Close</button>
        <h3 id=\"modelTitle\" class=\"text-lg font-bold mb-2\"></h3>
        <ol id=\"modelSteps\" class=\"list-decimal list-inside space-y-1 text-sm\"></ol>
        <p class=\"text-xs text-slate-500 mt-3\">Tip: Fold slowly with a steady exhale; use the metronome for pace.</p>
      </div>
    </div>

    <footer class=\"text-xs text-slate-500 pb-10\">
      <div class=\"flex items-center gap-4 mb-2\">
        <div>¬© <span id=\"yr\"></span> Vitals & Origami Analyzer ‚Ä¢ Recreational / educational only ‚Ä¢ If this is an emergency, call local medical services immediately.</div>
        <div class=\"ml-auto noprint flex items-center gap-2\">
          <span>QR for this site:</span>
          <img id=\"qr\" alt=\"QR Code\" class=\"w-16 h-16 rounded bg-white border\"/>
        </div>
      </div>
    </footer>
  </main>

  <script>
    // Helpers
    const el = id => document.getElementById(id);
    const setTag = (id, txt, tone) => {
      const n = el(id); n.textContent = txt; n.className = 'pill ' + (tone==='ok'?'bg-emerald-100 text-emerald-700': tone==='warn'?'bg-amber-100 text-amber-700': tone==='bad'?'bg-red-100 text-red-700':'bg-slate-100 text-slate-700');
    }

    // Live anxiety display
    el('anx').addEventListener('input', () => { el('anxValue').textContent = el('anx').value; });

    function interpretAll() {
      const ctx = [...document.querySelectorAll('input[name="ctx"]')].find(r=>r.checked).value;
      const v = {
        bpm: +el('bpm').value || NaN,
        brpm: +el('brpm').value || NaN,
        spm: +el('spm').value || NaN,
        sys: +el('sys').value || NaN,
        dia: +el('dia').value || NaN,
        spo2: +el('spo2').value || NaN,
        anx: +el('anx').value || 0
      };

      // BPM (adult general)
      if (isNaN(v.bpm)) setTag('bpmTag','‚Äî');
      else {
        let tone='ok', txt='Normal';
        if (ctx==='rest'){
          if (v.bpm<50){ tone='warn'; txt='Low (athletic?)'; }
          if (v.bpm<40){ tone='bad'; txt='Bradycardia'; }
          if (v.bpm>90){ tone='warn'; txt='High'; }
          if (v.bpm>100){ tone='bad'; txt='Tachycardia'; }
        } else { // active
          if (v.bpm<70){ tone='warn'; txt='Low for activity'; }
          if (v.bpm>160){ tone='warn'; txt='High for light activity'; }
          if (v.bpm>180){ tone='bad'; txt='Very high'; }
        }
        setTag('bpmTag', txt, tone);
      }

      // BRPM (adult)
      if (isNaN(v.brpm)) setTag('brpmTag','‚Äî');
      else {
        let tone='ok', txt='Normal';
        if (v.brpm<10){ tone='warn'; txt='Low'; }
        if (v.brpm<8){ tone='bad'; txt='Very low'; }
        if (v.brpm>20){ tone='warn'; txt='High'; }
        if (v.brpm>24){ tone='bad'; txt='Very high'; }
        setTag('brpmTag', txt, tone);
      }

      // SPM (cadence)
      if (isNaN(v.spm)) setTag('spmTag','‚Äî');
      else {
        let tone='ok', txt='Moderate walk';
        if (v.spm<60){ tone='warn'; txt='Very easy'; }
        if (v.spm>=90 && v.spm<120){ tone='ok'; txt='Brisk'; }
        if (v.spm>=120 && v.spm<140){ tone='ok'; txt='Very brisk'; }
        if (v.spm>=140){ tone='warn'; txt='Near jog'; }
        setTag('spmTag', txt, tone);
      }

      // BP (AHA style categories simplified)
      function bpCat(sys, dia){
        if (isNaN(sys)||isNaN(dia)) return ['‚Äî',null];
        if (sys>=180 || dia>=120) return ['Hypertensive crisis', 'bad'];
        if (sys>=140 || dia>=90) return ['Hypertension (Stage 2)','bad'];
        if ((sys>=130 && sys<=139) || (dia>=80 && dia<=89)) return ['Hypertension (Stage 1)','warn'];
        if (sys>=120 && sys<=129 && dia<80) return ['Elevated','warn'];
        if (sys<120 && dia<80) return ['Normal','ok'];
        return ['Uncategorized', null];
      }
      const [sysTxt, sysTone] = bpCat(v.sys, v.dia);
      setTag('sysTag', sysTxt, sysTone);
      setTag('diaTag', sysTxt, sysTone);

      // SpO2
      if (isNaN(v.spo2)) setTag('spo2Tag','‚Äî');
      else {
        let tone='ok', txt='Normal';
        if (v.spo2<95){ tone='warn'; txt='Below normal'; }
        if (v.spo2<92){ tone='bad'; txt='Low'; }
        setTag('spo2Tag', txt, tone);
      }

      // Anxiety tag
      (function(){
        const a=v.anx; let tone='ok', txt='Low';
        if (a>=4 && a<=6){ tone='warn'; txt='Moderate'; }
        if (a>=7){ tone='bad'; txt='High'; }
        setTag('anxTag', txt, tone);
      })();

      return v;
    }

    function analyzeToReport(){
      const v = interpretAll();
      const parts=[];
      const ctx = [...document.querySelectorAll('input[name="ctx"]')].find(r=>r.checked).value;

      function toneIcon(t){ return t==='bad'?'‚õî': t==='warn'?'‚ö†Ô∏è':'‚úÖ'; }

      // overall score (toy, recreational): start at 100 and subtract deviations
      let score=100;
      if (!isNaN(v.bpm)){
        if (ctx==='rest'){
          if (v.bpm<50) score-=5; if (v.bpm<40) score-=10;
          if (v.bpm>90) score-=5; if (v.bpm>100) score-=10;
        } else { if (v.bpm<70) score-=6; if (v.bpm>180) score-=12; }
      }
      if (!isNaN(v.brpm)){ if (v.brpm<10||v.brpm>20) score-=8; if (v.brpm<8||v.brpm>24) score-=6; }
      if (!isNaN(v.spm)){ if (v.spm<60) score-=3; if (v.spm>=140) score-=3; }
      if (!isNaN(v.sys) && !isNaN(v.dia)){
        if (v.sys>=180||v.dia>=120) score-=25; else if (v.sys>=140||v.dia>=90) score-=15; else if ((v.sys>=130&&v.sys<=139)||(v.dia>=80&&v.dia<=89)) score-=8; else if (v.sys>=120 && v.sys<=129 && v.dia<80) score-=3;
      }
      if (!isNaN(v.spo2)){ if (v.spo2<95) score-=6; if (v.spo2<92) score-=8; }
      if (!isNaN(v.anx)){ if (v.anx>=4) score-=5; if (v.anx>=7) score-=6; }
      score = Math.max(0, Math.min(100, Math.round(score)));

      const scoreHTML = `
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-slate-900 text-white rounded-2xl p-5">
            <div class="text-sm opacity-80">Recreational wellness score</div>
            <div class="text-4xl font-extrabold">${score}/100</div>
            <div class="mt-1 text-xs opacity-80">Higher is generally better. Toy metric ‚Äî not for diagnosis.</div>
          </div>
          <div class="rounded-2xl p-5 bg-emerald-50">
            <div class="font-semibold mb-1">Green flags</div>
            <ul id="greens" class="list-disc list-inside text-sm"></ul>
          </div>
          <div class="rounded-2xl p-5 bg-amber-50">
            <div class="font-semibold mb-1">Watch‚Äëouts</div>
            <ul id="yellows" class="list-disc list-inside text-sm"></ul>
          </div>
        </div>`;

      el('scoreWrap').innerHTML = scoreHTML;

      function add(listId, text){ const li=document.createElement('li'); li.textContent = text; el(listId).appendChild(li); }

      // Populate flag lists
      const bpmTxt = el('bpmTag').textContent; if (bpmTxt.includes('Normal')||bpmTxt.includes('Brisk')||bpmTxt.includes('Very brisk')) add('greens', `BPM/SPM look ${bpmTxt.toLowerCase()}.`); else add('yellows', `Heart rate looks ${bpmTxt.toLowerCase()}. Consider rest, hydration, or checking again.`);
      const brpmTxt = el('brpmTag').textContent; if (brpmTxt==='Normal') add('greens','Breathing rate in normal range.'); else add('yellows',`Breathing rate ${brpmTxt.toLowerCase()}. Try slow exhale 6s breathing.`);
      const bpTxt = el('sysTag').textContent; if (bpTxt==='Normal') add('greens','Blood pressure in normal range.'); else if (bpTxt!=='‚Äî') add('yellows',`Blood pressure category: ${bpTxt}. Consider multiple readings and consulting a clinician.`);
      const spo2Txt = el('spo2Tag').textContent; if (spo2Txt==='Normal') add('greens','SpO‚ÇÇ looks okay.'); else if (spo2Txt!=='‚Äî') add('yellows',`SpO‚ÇÇ ${spo2Txt.toLowerCase()}. Warm hands, deep breaths, or recheck sensor.`);
      const anxTxt = el('anxTag').textContent; if (anxTxt==='Low') add('greens','Self‚Äërated anxiety is low today.'); else add('yellows',`Anxiety ${anxTxt.toLowerCase()}. Try short breathing + origami focus break.`);

      // Findings text
      const f = [];
      if (!isNaN(v.bpm)) f.push(`${toneIcon(el('bpmTag').className.includes('red')?'bad':el('bpmTag').className.includes('amber')?'warn':'ok')} Heart rate: ${v.bpm} BPM (${el('bpmTag').textContent}).`);
      if (!isNaN(v.brpm)) f.push(`${toneIcon(el('brpmTag').className.includes('red')?'bad':el('brpmTag').className.includes('amber')?'warn':'ok')} Breaths: ${v.brpm}/min (${el('brpmTag').textContent}).`);
      if (!isNaN(v.spm)) f.push(`${toneIcon(el('spmTag').className.includes('red')?'bad':el('spmTag').className.includes('amber')?'warn':'ok')} Steps cadence: ${v.spm} SPM (${el('spmTag').textContent}).`);
      if (!isNaN(v.sys) && !isNaN(v.dia)) f.push(`${toneIcon(el('sysTag').className.includes('red')?'bad':el('sysTag').className.includes('amber')?'warn':'ok')} BP: ${v.sys}/${v.dia} mmHg (${el('sysTag').textContent}).`);
      if (!isNaN(v.spo2)) f.push(`${toneIcon(el('spo2Tag').className.includes('red')?'bad':el('spo2Tag').className.includes('amber')?'warn':'ok')} SpO‚ÇÇ: ${v.spo2}%.`);
      f.push(`${toneIcon(el('anxTag').className.includes('red')?'bad':el('anxTag').className.includes('amber')?'warn':'ok')} Anxiety (self‚Äërated): ${v.anx}/10 (${el('anxTag').textContent}).`);
      const orig = el('origami').value;
      if(orig==="yes") f.push(`ü¶¢ Origami today: Positive ‚Äî rhythmic folding may support calm and focus.`);
      if(orig==="no") f.push(`ü¶¢ Origami today: Consider 5‚Äì10 minutes of simple folding for grounding.`);
      const notes = el('notes').value?.trim(); if (notes) f.push(`üóíÔ∏è Notes: ${notes}`);

      el('findings').innerHTML = f.map(x=>`<p>${x}</p>`).join('');
      el('results').classList.remove('hidden');
      window.scrollTo({ top: el('results').offsetTop - 80, behavior: 'smooth' });
    }

    // Buttons
    el('btnAnalyze').addEventListener('click', analyzeToReport);
    el('btnPrint').addEventListener('click', () => window.print());
    el('btnReset').addEventListener('click', () => { document.querySelectorAll('input, textarea').forEach(i=>{ if(i.type==='radio'){ i.checked = i.value==='rest'; } else if(i.type==='range'){ i.value=3; el('anxValue').textContent='3'; } else { i.value=''; } }); ['bpmTag','brpmTag','spmTag','sysTag','diaTag','spo2Tag','anxTag'].forEach(id=>setTag(id,'‚Äî')); el('results').classList.add('hidden'); localStorage.removeItem('vitals_last'); });
    el('btnDemo').addEventListener('click', () => { el('bpm').value=76; el('brpm').value=14; el('spm').value=112; el('sys').value=124; el('dia').value=82; el('spo2').value=97; el('anx').value=4; el('anxValue').textContent='4'; interpretAll(); });

    el('btnSave').addEventListener('click', () => {
      const payload = {
        ts: new Date().toISOString(),
        bpm: el('bpm').value, brpm: el('brpm').value, spm: el('spm').value, sys: el('sys').value, dia: el('dia').value, spo2: el('spo2').value, anx: el('anx').value, notes: el('notes').value, ctx: [...document.querySelectorAll('input[name="ctx"]')].find(r=>r.checked).value
      };
      localStorage.setItem('vitals_last', JSON.stringify(payload));
      alert('Saved locally on this browser.');
    });

    el('btnLoad').addEventListener('click', () => {
      const raw = localStorage.getItem('vitals_last');
      if(!raw) return alert('No saved session found.');
      const p = JSON.parse(raw);
      el('bpm').value=p.bpm||''; el('brpm').value=p.brpm||''; el('spm').value=p.spm||''; el('sys').value=p.sys||''; el('dia').value=p.dia||''; el('spo2').value=p.spo2||''; el('anx').value=p.anx||3; el('anxValue').textContent=el('anx').value; el('notes').value=p.notes||''; [...document.querySelectorAll('input[name="ctx"]').forEach(r=>r.checked=(r.value===p.ctx))]; interpretAll();
    });

    // Init
    interpretAll();
    el('yr').textContent = new Date().getFullYear();
  // Dark mode toggle
    (function(){
      const root = document.documentElement;
      function apply(mode){ if(mode==='dark'){ root.classList.add('dark'); document.body.classList.add('bg-slate-900','text-slate-100'); } else { root.classList.remove('dark'); document.body.classList.remove('bg-slate-900','text-slate-100'); } }
      const saved = localStorage.getItem('theme'); apply(saved||'light');
      el('btnDark').addEventListener('click',()=>{ const next = document.documentElement.classList.contains('dark')?'light':'dark'; localStorage.setItem('theme', next); apply(next); });
    })();

    // QR code (via qrserver)
    (function(){
      const url = encodeURIComponent(location.href);
      const img = el('qr'); if(img) img.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${url}`;
    })();

    // Breathing ball animation
    let breathTimer=null, breathPhase=['Inhale','Hold','Exhale','Hold'], breathIdx=0;
    function setBall(scale){ const b=el('breathBall'); b.style.transform = `translate(-50%,-50%) scale(${scale})`; }
    el('breathStart').addEventListener('click',()=>{ clearInterval(breathTimer); breathIdx=0; el('breathPhase').textContent='Inhale'; setBall(0.8); let t=0; breathTimer=setInterval(()=>{ t=(t+1)%16; const phase=Math.floor(t/4); if(phase!==breathIdx){ breathIdx=phase; el('breathPhase').textContent=breathPhase[phase]; } const pos = [0.8,1.0,0.8,0.75][phase]; setBall(pos); },1000); });
    el('breathStop').addEventListener('click',()=>{ clearInterval(breathTimer); el('breathPhase').textContent='Ready'; setBall(1); });

    // Folding metronome (WebAudio)
    let audioCtx=null, metroInt=null;
    function tick(){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.001; o.connect(g); g.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.001); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.12); o.stop(audioCtx.currentTime+0.13);}
    const fpm = el('foldFPM'); const fpmVal = el('foldFPMVal'); fpm.addEventListener('input',()=>{ fpmVal.textContent=fpm.value; if(metroInt){ clearInterval(metroInt); metroInt=setInterval(tick, 60000/parseInt(fpm.value)); }});
    el('metroStart').addEventListener('click',()=>{ clearInterval(metroInt); metroInt=setInterval(tick, 60000/parseInt(fpm.value)); tick(); });
    el('metroStop').addEventListener('click',()=>{ clearInterval(metroInt); });

    // Save now appends to a log + CSV export
    function toCSV(rows){ return rows.map(r=>Object.values(r).map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('
'); }
    el('btnSave').addEventListener('click', () => {
      const payload = {
        ts: new Date().toISOString(),
        bpm: el('bpm').value, brpm: el('brpm').value, spm: el('spm').value, sys: el('sys').value, dia: el('dia').value, spo2: el('spo2').value, anx: el('anx').value, notes: el('notes').value, ctx: [...document.querySelectorAll('input[name=\"ctx\"]')].find(r=>r.checked).value, origami: (document.getElementById('origami')?.value)||''
      };
      localStorage.setItem('vitals_last', JSON.stringify(payload));
      const log = JSON.parse(localStorage.getItem('vitals_log')||'[]'); log.push(payload); localStorage.setItem('vitals_log', JSON.stringify(log));
      alert('Saved locally on this browser.');
    });
    el('btnExport').addEventListener('click',()=>{ const log = JSON.parse(localStorage.getItem('vitals_log')||'[]'); if(!log.length) return alert('No saved sessions to export.'); const header = Object.keys(log[0]); const csv = [header.join(','), toCSV(log)].join('
'); const blob = new Blob([csv], {type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='vitals-origami-log.csv'; a.click(); URL.revokeObjectURL(a.href); });
  // Origami Gallery logic
    const MODELS = {
      boat: {title:'Paper Boat', steps:[
        'Start with an A4/letter sheet; fold in half (short edges together).',
        'With the fold at the top, fold corners down to meet the center, forming a triangle with a rectangle under it.',
        'Fold the bottom front flap up. Flip, fold the other bottom flap up.',
        'Open the hat shape into a diamond (square) and flatten.',
        'Fold bottom point up to top point, flip and repeat to make a smaller diamond.',
        'Open from the bottom ‚Äî pull the two top corners apart to form the boat. Flatten the base.'
      ]},
      airplane: {title:'Paper Airplane (Dart)', steps:[
        'Start with A4; fold in half lengthwise, then unfold (leave the crease).',
        'Bring the top two corners to the center crease (kite shape).',
        'Fold the new top edges to the center again (long narrow triangle).',
        'Fold the plane in half on the original center crease (flaps outside).',
        'Fold each wing down so the top edge lines up with the bottom edge.',
        'Add small wing tips if desired; launch with a gentle level throw.'
      ]},
      crane: {title:'Traditional Crane', steps:[
        'Start with a square; color side up. Fold diagonals; turn over; fold in half both ways. Return to square.',
        'Collapse into a square base (diamond) by bringing side points in.',
        'With open end down, fold right and left edges to center; unfold; lift bottom corner up and squash into a long diamond. Repeat on back.',
        'Fold the top layers‚Äô sides to center (thin kite); fold both ‚Äúlegs‚Äù up inside for head and tail.',
        'Reverse-fold one tip for the head; pull wings out gently and flatten body.'
      ]},
      flower: {title:'Simple Tulip', steps:[
        'Start with a square; fold in half diagonally to make a triangle.',
        'Bring left and right corners up to the top point, forming a diamond.',
        'Fold the side points slightly behind to round the tulip.',
        'Fold the bottom front tip up; flip and fold back tip up.',
        'Roll a thin stem from a strip of paper; slot into the bottom pocket.'
      ]},
      frog: {title:'Jumping Frog', steps:[
        'Use a 3:2 rectangle (cut a strip from A4).',
        'Fold in half; open. Fold top corners to the center to form an X, then push in to make a triangle (waterbomb base).',
        'Fold sides to center line; fold bottom up to meet the base of the triangle.',
        'Make the rear legs: fold the bottom corners outwards, then fold the whole bottom section up, and in half to create a spring.',
        'Press on the back and release ‚Äî the frog jumps!'
      ]}
    };
    function openModel(key){ const m=MODELS[key]; if(!m) return; el('modelTitle').textContent=m.title; el('modelSteps').innerHTML=m.steps.map(s=>`<li>${s}</li>`).join(''); const modal=el('modelModal'); modal.classList.remove('hidden'); modal.classList.add('flex'); }
    document.querySelectorAll('[data-model]').forEach(btn=>btn.addEventListener('click',()=>openModel(btn.dataset.model)));
    el('modalClose').addEventListener('click',()=>{ const modal=el('modelModal'); modal.classList.add('hidden'); modal.classList.remove('flex'); });
    el('modelModal').addEventListener('click',(e)=>{ if(e.target.id==='modelModal'){ const modal=e.currentTarget; modal.classList.add('hidden'); modal.classList.remove('flex'); }});
  </script>
</body>
</html>

